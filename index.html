<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with netCDF for Essential Biodiversity Variables • ebvcube</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Working with netCDF for Essential Biodiversity Variables">
<meta property="og:description" content="The concept of Essential Biodiversity Variables (EBV, &lt;https://geobon.org/ebvs/what-are-ebvs/&gt;) comes with a data structure based on the Network Common Data Form (netCDF). The ebvcube R package provides functionality to easily create, access and visualise this data. The EBV netCDFs can be downloaded from the EBV Data Portal: Christian Langer/ iDiv (2020) &lt;https://portal.geobon.org/&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ebvcube</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="news/index.html">NEWS</a>
</li>
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li>
  <a href="CONTRIBUTING.html">Contributing</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LuiseQuoss/ebvcube" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://www.facebook.com/" class="external-link">
    <span class="fa fa-facebook"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="ebvcube-package">ebvcube package<a class="anchor" aria-label="anchor" href="#ebvcube-package"></a>
</h1></div>
<!-- badges: start -->

<p>This package can be used to easily access the data of the EBV netCDFs which can be downloaded from the <a href="https://portal.geobon.org/" class="external-link">EBV Data Portal</a>. It also provides some basic visualization. Advanced users can build their own netCDFs following the EBV structure.</p>
<div class="section level2">
<h2 id="id_1-basis">1. Basis<a class="anchor" aria-label="anchor" href="#id_1-basis"></a>
</h2>
<p>The EBV netCDF structure is designed to hold Essential Biodiversity Variables. This concept is further described <a href="https://geobon.org/ebvs/what-are-ebvs/" class="external-link">here</a>. The files are based on the <a href="https://www.unidata.ucar.edu/software/netcdf/" class="external-link">Network Common Data Format</a> (netCDF). Additionally, it follows the <a href="https://cfconventions.org/Data/cf-conventions/cf-conventions-1.8/cf-conventions.html" class="external-link">Climate and Forecast Conventions</a> (CF, version 1.8) and the <a href="https://wiki.esipfed.org/Attribute_Convention_for_Data_Discovery_1-3" class="external-link">Attribute Convention for Data Discovery</a> (ACDD, version 1.3).</p>
</div>
<div class="section level2">
<h2 id="id_2-data-structure">2. Data structure<a class="anchor" aria-label="anchor" href="#id_2-data-structure"></a>
</h2>
<p>The structure allows several datacubes per netCDF file. These cubes have four dimensions: longitude, latitude, time and entity, whereby the last dimension can, e.g., encompass different species or groups of species, ecosystem types or other. The usage of hierarchical groups enables the coexistence of multiple data cubes. All cubes share the same dimensions. The first level (netCDF group) are scenarios, e.g., the modelling for different Shared Socioeconomic Pathways (SSP) scenarios. The second level (netCDF group) are metrics, e.g., the percentage of protected area per pixel and its proportional loss over a certain time span per pixel. All metrics are repeated per scenario, if any are present.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">├──</span> scenario_1</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">│</span>   └── metric_1</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">│</span>       └── ebv_cube [lon, lat, time, entity]</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">└──</span> scenario_2</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="ex">└──</span> metric_2</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>        <span class="ex">└──</span> ebv_cube [lon, lat, time, entity]</span></code></pre></div>
<p>Just keep in mind: All EBV netCDF always have a metric. But they may or may not have a scenario. The resulting datacubes hold the data. These datacubes are 4D.</p>
</div>
<div class="section level2">
<h2 id="id_2-installation">2. Installation<a class="anchor" aria-label="anchor" href="#id_2-installation"></a>
</h2>
<p>You can install the ebvcube packages with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get the current version on CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'ebvcube'</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#install the latest version from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'https://github.com/LuiseQuoss/ebvcube/tree/dev'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_3-working-with-the-package---a-quick-intro">3. Working with the package - a quick intro<a class="anchor" aria-label="anchor" href="#id_3-working-with-the-package---a-quick-intro"></a>
</h2>
<p>The example data set used in this README is a spatial subset (African continent) of the <a href="https://portal.geobon.org/ebv-detail?id=1" class="external-link">Local bird diversity (cSAR/BES-SIM)</a> data set by Ines Martins.</p>
<div class="section level3">
<h3 id="id_31-take-a-very-first-look-at-the-file">3.1 Take a very first look at the file<a class="anchor" aria-label="anchor" href="#id_31-take-a-very-first-look-at-the-file"></a>
</h3>
<p>With the following two functions you get the metadata of a specific EBV netCDF file. First we take a look at some basic metadata of that file. The properties encompass much more information!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LuiseQuoss/ebvcube" class="external-link">ebvcube</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#set the path to the file</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"martins_comcom_subset.nc"</span><span class="op">)</span>, package<span class="op">=</span><span class="st">"ebvcube"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#read the properties of the file</span></span>
<span><span class="va">prop.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_properties.html">ebv_properties</a></span><span class="op">(</span><span class="va">file</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#take a look at the general properties of the data set - there are more properties to discover!</span></span>
<span><span class="va">prop.file</span><span class="op">@</span><span class="va">general</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt; $title</span></span>
<span><span class="co">#&gt; [1] "Local bird diversity (cSAR/BES-SIM)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Changes in bird diversity at 1-degree resolution caused by land use, estimated by the cSAR model for 1900-2015 using LUH2.0 historical reconstruction of land-use."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ebv_class</span></span>
<span><span class="co">#&gt; [1] "Community composition"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ebv_name</span></span>
<span><span class="co">#&gt; [1] "Taxonomic and phylogenetic diversity"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slotNames</span><span class="op">(</span><span class="va">prop.file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "general"  "spatial"  "temporal" "metric"   "scenario" "ebv_cube"</span></span></code></pre></div>
<p>Now let’s get the paths to all possible datacubes. The resulting data.frame includes the paths and also descriptions of the metric and/or scenario and/or entity. The paths basically consist of the nested structure of scenario, metric and the datacube.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datacubes</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_datacubepaths.html">ebv_datacubepaths</a></span><span class="op">(</span><span class="va">file</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">datacubes</span></span>
<span><span class="co">#&gt;       datacubepaths                                 metric_names</span></span>
<span><span class="co">#&gt; 1 metric_1/ebv_cube Relative change in the number of species (%)</span></span>
<span><span class="co">#&gt; 2 metric_2/ebv_cube     Absolute change in the number of species</span></span></code></pre></div>
<p>In the next step we will get the properties of one specific datacube - fyi: the result also holds the general file properties from above.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prop.dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_properties.html">ebv_properties</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">datacubes</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">prop.dc</span><span class="op">@</span><span class="va">metric</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "Relative change in the number of species (%)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Relative change in the number of species (S) using the year 1900 as reference (e.g. -50 corresponds to a decrease in 50% of the number of species in the cell since 1900, (S_year-S_1900)/S_1900*100)"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_32-plot-the-data-to-get-a-better-impression">3.2 Plot the data to get a better impression<a class="anchor" aria-label="anchor" href="#id_32-plot-the-data-to-get-a-better-impression"></a>
</h3>
<p>To discover the spatial distribution of the data, you can plot a map of the datacube that we just looked at. It has 12 timesteps. Here we look at the first one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot the global map</span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="va">datacubes</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="reference/ebv_map.html">ebv_map</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">dc</span>, entity<span class="op">=</span><span class="fl">1</span>, timestep <span class="op">=</span> <span class="fl">1</span>, classes <span class="op">=</span> <span class="fl">9</span>,</span>
<span>        verbose<span class="op">=</span><span class="cn">FALSE</span>, col_rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
<p>It’s nice to see the global distribution, but how is the change of that datacube (non forest birds) over time? Let’s take a look at the average. The function returns the values, catch them!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get the averages and plot</span></span>
<span><span class="va">averages</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_trend.html">ebv_trend</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">dc</span>, entity<span class="op">=</span><span class="fl">1</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">averages</span></span>
<span><span class="co">#&gt;  [1]  0.6140731  1.2972444  2.2045310  3.6016083  6.4691830  8.8957375</span></span>
<span><span class="co">#&gt;  [7]  9.7711291 10.3299345 10.9822654 11.5685090 11.9421034 12.3869482</span></span></code></pre></div>
<p>It would be cool to have that for other indicators as well? Check out the different options for ‘method’.</p>
</div>
<div class="section level3">
<h3 id="id_33-read-the-data-from-the-files-to-start-working">3.3 Read the data from the files to start working<a class="anchor" aria-label="anchor" href="#id_33-read-the-data-from-the-files-to-start-working"></a>
</h3>
<p>Before you actually load the data it may be nice to get an impression of the value range and other basic measurements.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#info for whole dataset</span></span>
<span><span class="va">measurements</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_analyse.html">ebv_analyse</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">dc</span>, entity<span class="op">=</span><span class="fl">1</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#see the included measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">measurements</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "min"  "q25"  "q50"  "mean" "q75"  "max"  "std"  "n"    "NAs"</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#check out the mean and the number of pixels</span></span>
<span><span class="va">measurements</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="co">#&gt; [1] 0.6140731</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measurements</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 7650</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#info for a subset defined by a bounding box</span></span>
<span><span class="co">#you can also define the subset by a Shapefile - check it out!</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">26</span>, <span class="fl">64</span>, <span class="fl">30</span>, <span class="fl">38</span><span class="op">)</span></span>
<span><span class="va">measurements.bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_analyse.html">ebv_analyse</a></span><span class="op">(</span><span class="va">file</span>,<span class="va">dc</span>, entity <span class="op">=</span> <span class="fl">1</span>, subset <span class="op">=</span> <span class="va">bb</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#check out the mean of the subset</span></span>
<span><span class="va">measurements.bb</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="co">#&gt; [1] 0.3241093</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measurements.bb</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 720</span></span></code></pre></div>
<p>To access the first three timesteps of the data you can use the following:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load whole data as array for two timesteps</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_read.html">ebv_read</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">dc</span>, entity <span class="op">=</span> <span class="fl">1</span>, timestep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, type <span class="op">=</span> <span class="st">'a'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 85 90  3</span></span></code></pre></div>
<p>You can also get a spatial subset of the data by providing a Shapefile.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load subset from shapefile (Cameroon)</span></span>
<span><span class="va">shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'extdata'</span>,<span class="st">'cameroon.shp'</span><span class="op">)</span>, package<span class="op">=</span><span class="st">"ebvcube"</span><span class="op">)</span></span>
<span><span class="va">data.shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_read_shp.html">ebv_read_shp</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">dc</span>, entity<span class="op">=</span><span class="fl">1</span>, shp <span class="op">=</span> <span class="va">shp</span>, timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data.shp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12  9  3</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#very quick plot of the resulting raster plus the shapefile</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">shp</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tidyterra</span><span class="fu">::</span><span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data.shp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tidyterra</span><span class="fu">::</span><span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">borders</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_fermenter</a></span><span class="op">(</span>na.value<span class="op">=</span><span class="cn">NA</span>, palette <span class="op">=</span> <span class="st">'YlGn'</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"> Imagine you have a very large dataset but only limited memory. The package provides the possibility to load the data as a DelayedArray. The ebv_write() function helps you to write that data back on disk properly. Look into the manual to obtain more information.</p>
</div>
<div class="section level3">
<h3 id="id_34-take-a-peek-on-the-creation-of-an-ebv-netcdf">3.4 Take a peek on the creation of an EBV netCDF<a class="anchor" aria-label="anchor" href="#id_34-take-a-peek-on-the-creation-of-an-ebv-netcdf"></a>
</h3>
<div class="section level4">
<h4 id="a-create-an-empty-ebv-netcdf-with-metadata">a. Create an empty EBV netCDF (with metadata)<a class="anchor" aria-label="anchor" href="#a-create-an-empty-ebv-netcdf-with-metadata"></a>
</h4>
<p>First of all, you have to insert all the metadata in the <a href="https://portal.geobon.org/home" class="external-link">EBV Data Portal</a> and then use the resulting text file (json format) to create an empty netCDF which complies to the EBV netCDF structure, i.e., it has the correct structure mapped to your data and holds the metadata. Additionally to that (json) text file, the function needs a list of all entities the netCDF (see help page for detailed information) will encompass and geospatial information such as the coordinate reference system.</p>
<p>The example is based on the <a href="https://portal.geobon.org/ebv-detail?id=1" class="external-link">Local bird diversity (cSAR/BES-SIM)</a>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#paths</span></span>
<span><span class="va">json</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'extdata'</span>,<span class="st">'metadata.json'</span><span class="op">)</span>, package<span class="op">=</span><span class="st">"ebvcube"</span><span class="op">)</span></span>
<span><span class="va">newNc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"ebvcube"</span><span class="op">)</span>,<span class="st">'extdata'</span>,<span class="st">'test.nc'</span><span class="op">)</span></span>
<span><span class="va">entities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'forest bird species'</span>,<span class="st">'non-forest bird species'</span>,<span class="st">'all bird species'</span><span class="op">)</span></span>
<span><span class="co">#defining the fillvalue - optional</span></span>
<span><span class="va">fv</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3.4e+38</span></span>
<span><span class="co">#create the netCDF</span></span>
<span><span class="fu"><a href="reference/ebv_create.html">ebv_create</a></span><span class="op">(</span>jsonpath <span class="op">=</span> <span class="va">json</span>, outputpath <span class="op">=</span> <span class="va">newNc</span>, entities <span class="op">=</span> <span class="va">entities</span>,</span>
<span>           epsg <span class="op">=</span> <span class="fl">4326</span>, extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, <span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span><span class="op">)</span>, resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>           fillvalue <span class="op">=</span> <span class="va">fv</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#needless to say: check the properties of your newly created file to see if you get what you want</span></span>
<span><span class="co">#especially the entity_names from the slot general should be checked to see if your csv was formatted the right way</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="reference/ebv_properties.html">ebv_properties</a></span><span class="op">(</span><span class="va">newNc</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">@</span><span class="va">general</span><span class="op">$</span><span class="va">entity_names</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "forest bird species"     "non-forest bird species"</span></span>
<span><span class="co">#&gt; [3] "all bird species"</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#check out the (still empty) datacubes that are available</span></span>
<span><span class="va">dc.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ebv_datacubepaths.html">ebv_datacubepaths</a></span><span class="op">(</span><span class="va">newNc</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dc.new</span><span class="op">)</span></span>
<span><span class="co">#&gt;       datacubepaths                                 metric_names</span></span>
<span><span class="co">#&gt; 1 metric_1/ebv_cube Relative change in the number of species (%)</span></span>
<span><span class="co">#&gt; 2 metric_2/ebv_cube     Absolute change in the number of species</span></span></code></pre></div>
<p>Hint: You can always take a look at your netCDF in <a href="https://www.giss.nasa.gov/tools/panoply/" class="external-link">Panoply</a> provided by NASA. That’s very helpful to understand the structure.</p>
</div>
<div class="section level4">
<h4 id="b-add-your-data-to-the-ebv-netcdf">b. Add your data to the EBV NetCDF<a class="anchor" aria-label="anchor" href="#b-add-your-data-to-the-ebv-netcdf"></a>
</h4>
<p>In the next step you can add your data to the netCDF from GeoTiff files or in-memory objects (matrix/array). You need to indicate the datacubepath the data belongs to. You can add your data timestep per timestep, in slices or all at once. You can simply add more data to the same datacube by changing the timestep definition.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#path to tif with data</span></span>
<span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'extdata'</span><span class="op">)</span>, package<span class="op">=</span><span class="st">"ebvcube"</span><span class="op">)</span></span>
<span><span class="va">tifs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'entity1.tif'</span>, <span class="st">'entity2.tif'</span>, <span class="st">'entity3.tif'</span><span class="op">)</span></span>
<span><span class="va">tif_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">root</span>, <span class="va">tifs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#adding the data</span></span>
<span><span class="va">entity</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">tif</span> <span class="kw">in</span> <span class="va">tif_paths</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/ebv_add_data.html">ebv_add_data</a></span><span class="op">(</span>filepath_nc <span class="op">=</span> <span class="va">newNc</span>, datacubepath<span class="op">=</span><span class="va">dc.new</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, entity <span class="op">=</span> <span class="va">entity</span>,</span>
<span>              timestep<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, data <span class="op">=</span> <span class="va">tif</span>, band<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">entity</span> <span class="op">&lt;-</span> <span class="va">entity</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="c-add-missing-attributes-to-datacube">c. Add missing attributes to datacube<a class="anchor" aria-label="anchor" href="#c-add-missing-attributes-to-datacube"></a>
</h4>
<p>Ups! So you did a mistake and want to change the attribute?! No problem. Just use the upcoming function to change it.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ebv_attribute.html">ebv_attribute</a></span><span class="op">(</span><span class="va">newNc</span>, attribute_name<span class="op">=</span><span class="st">'units'</span>, value<span class="op">=</span><span class="st">'Percentage'</span>, levelpath<span class="op">=</span><span class="va">dc.new</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#check the properties one more time - perfect!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="reference/ebv_properties.html">ebv_properties</a></span><span class="op">(</span><span class="va">newNc</span>, <span class="va">dc.new</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">@</span><span class="va">ebv_cube</span><span class="op">$</span><span class="va">units</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Percentage"</span></span></code></pre></div>
<p>In this case the levelpath corresponds to the datacube path. But you can also alter attributes at the metric or scenario level. See the manual for more info.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="id_4-cite-package">4. Cite package<a class="anchor" aria-label="anchor" href="#id_4-cite-package"></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">'ebvcube'</span><span class="op">)</span></span>
<span><span class="co">#&gt; To cite ebvcube in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Quoss L, Fernandez N, Langer C, Valdez J, Pereira H (2023). _ebvcube:</span></span>
<span><span class="co">#&gt;   Working with netCDF for Essential Biodiversity Variables_. German</span></span>
<span><span class="co">#&gt;   Centre for Integrative Biodiversity Research (iDiv)</span></span>
<span><span class="co">#&gt;   Halle-Jena-Leipzig, Germany. R package version 0.2.1,</span></span>
<span><span class="co">#&gt;   &lt;https://github.com/LuiseQuoss/ebvcube&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Manual{,</span></span>
<span><span class="co">#&gt;     title = {ebvcube: Working with netCDF for Essential Biodiversity Variables},</span></span>
<span><span class="co">#&gt;     author = {Luise Quoss and Nestor Fernandez and Christian Langer and Jose Valdez and Henrique Miguel Pereira},</span></span>
<span><span class="co">#&gt;     year = {2023},</span></span>
<span><span class="co">#&gt;     note = {R package version 0.2.1},</span></span>
<span><span class="co">#&gt;     organization = {German Centre for Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig},</span></span>
<span><span class="co">#&gt;     address = {Germany},</span></span>
<span><span class="co">#&gt;     url = {https://github.com/LuiseQuoss/ebvcube},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="list-of-all-functions">List of all functions<a class="anchor" aria-label="anchor" href="#list-of-all-functions"></a>
</h2>
<table class="table">
<colgroup>
<col width="22%">
<col width="23%">
<col width="53%">
</colgroup>
<thead><tr class="header">
<th align="left">Functionality</th>
<th align="left">Function</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Basic access</td>
<td align="left">ebv_datacubepaths</td>
<td align="left">Get all available data cubes in the netCDF</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_properties</td>
<td align="left">Get all the metadata of the netCDF</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">ebv_download</td>
<td align="left">Download EBV netCDFs from the EBV Portal</td>
</tr>
<tr class="even">
<td align="left">Data access</td>
<td align="left">ebv_read</td>
<td align="left">Read the data</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">ebv_read_bb</td>
<td align="left">Read a spatial subset given by a bounding box</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_read_shp</td>
<td align="left">Read a spatial subset given by a Shapefile</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">ebv_analyse</td>
<td align="left">Get basic measurements of the data</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_write</td>
<td align="left">Write manipulated data back to disc</td>
</tr>
<tr class="odd">
<td align="left">Data visualization</td>
<td align="left">ebv_map</td>
<td align="left">Plot a map of the specified data slice</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_trend</td>
<td align="left">Plot the temporal trend</td>
</tr>
<tr class="odd">
<td align="left">Data creation</td>
<td align="left">ebv_create</td>
<td align="left">Create a new EBV netCDF</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_create_taxonomy</td>
<td align="left">Create a new EBV netCDF with taxonomy info</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">ebv_add_data</td>
<td align="left">Add data to the new netCDF</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">ebv_attribute</td>
<td align="left">Change an attribute value</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=ebvcube" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/LuiseQuoss/ebvcube/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/LuiseQuoss/ebvcube/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ebvcube</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Luise Quoss <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9910-1252" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Nestor Fernandez <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9645-8571" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Christian Langer <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-1446-3527" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Jose Valdez <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-2690-9952" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Henrique Miguel Pereira <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-1043-1675" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=ebvcube" class="external-link"><img src="https://www.r-pkg.org/badges/version/ebvcube" alt="CRAN status"></a></li>
<li><a href="https://github.com/LuiseQuoss/ebvcube/actions/workflows/R.yaml" class="external-link"><img src="https://github.com/LuiseQuoss/ebvcube/actions/workflows/R.yaml/badge.svg?branch=dev" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/LuiseQuoss/ebvcube" class="external-link"><img src="https://codecov.io/gh/LuiseQuoss/ebvcube/graph/badge.svg?token=2TVFHRKBNJ" alt="codecov"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Luise Quoss, Nestor Fernandez, Christian Langer, Jose Valdez, Henrique Miguel Pereira.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
